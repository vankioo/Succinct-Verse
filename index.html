<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Succinct Verse</title>
    <link rel="stylesheet" type="text/css" href="assets/flaticon/flaticon.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="welcome-screen">
        <div class="welcome-box">
            <h1>Succinct Verse</h1>
            <p>An interactive project universe.</p>
            <button id="enter-btn">Click to Enter</button>
        </div>
    </div>
    <div id="main-app" class="hidden">
        <header class="top-menubar">
            <div class="menu-left"><span class="app-name">Succinct Verse</span></div>
            <div class="menu-right">
                <div id="notification-widget"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H6.414l-3.707 2.354A.5.5 0 0 1 2 15.914V2z"/></svg><span class="notification-badge"></span><div class="notification-dropdown"><div class="dropdown-header">Notifications</div><ul id="notification-list"></ul></div></div>
                <div class="cpu-widget"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M9 2v2H7V2H5v2H4a2 2 0 0 0-2 2v2h2v8H2v2a2 2 0 0 0 2 2h1v2h2v-2h2v2h2v-2h8v2h2v-2h2a2 2 0 0 0 2-2v-2h-2V8h2V6a2 2 0 0 0-2-2h-1V2h-2v2h-2V2h-2v2H9V2H7zm0 4h8v12H7V6z"/></svg><div class="cpu-bar-container"><div class="cpu-bar"></div></div></div>
                <span id="date-widget"></span><span id="clock">10:10</span>
            </div>
        </header>
        <main class="desktop">
            <a href="https://succinct-network.vercel.app/" target="_blank" class="desktop-icon"><img src="assets/images/icon1.png" alt="ZK Constellation"><span>ZK Constellation</span></a>
            <a href="#" target="_blank" class="desktop-icon"><img src="assets/images/icon3.png" alt="Proof of Synergy"><span>Proof of Synergy</span></a>
            <a href="https://succinct-zk-forge.vercel.app/" target="_blank" class="desktop-icon"><img src="assets/images/icon2.png" alt="ZK Forge"><span>ZK Forge</span></a>
        </main>
        <footer class="dock">
            <div class="dock-container">
                <a href="javascript:void(0);" id="open-community-board" class="dock-item" title="Community Board"><i class="fi fi-rr-palette"></i> <span>Community Board</span></a>
                <a href="javascript:void(0);" id="open-sp1-verifier" class="dock-item" title="SP1 Verifier"><i class="fi fi-rr-shield-check"></i> <span>SP1 Verifier</span></a>
                <div class="separator"></div>
                <a href="https://twitter.com/vankioo" target="_blank" class="dock-item" title="Twitter/X"><i class="fi fi-brands-twitter-x"></i> <span>Twitter/X</span></a>
                <a href="https://discord.gg/succinctlabs" target="_blank" class="dock-item" title="Discord"><i class="fi fi-brands-discord"></i> <span>Discord</span></a>
            </div>
        </footer>
    </div>
    <audio id="background-music" src="assets/backsound.mp3" loop></audio>
    <div id="sp1-verifier-modal" class="modal-container hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button id="close-sp1-modal" class="modal-close-btn">&times;</button>
            <h2>SP1 Verifier</h2><p>Simulating program execution and ZK proof generation.</p><div id="sp1-console" class="console"></div>
        </div>
    </div>
    <div id="community-board-modal" class="modal-container hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content wide">
            <button id="close-community-modal" class="modal-close-btn">&times;</button>
            <h2>Community Memorial Wall</h2>
            <div id="gallery-view">
                <div class="gallery-header">
                    <p>All art contributed by the Succinct Verse community.</p>
                    <button id="go-to-drawing-btn" class="submit-art-btn small">Add Your Art</button>
                </div>
                <div id="art-gallery-container"><p class="loading-text">Loading memorial wall...</p></div>
            </div>
            <div id="drawing-view" class="hidden">
                <p>Leave your mark on the canvas!</p>
                <div class="drawing-area">
                    <div class="tools">
                        <label for="colorPicker">Color:</label><input type="color" id="colorPicker" value="#FE11C5">
                        <label for="brushSize">Size:</label><input type="range" id="brushSize" min="1" max="50" value="5">
                        <button id="eraserBtn">Eraser</button><button id="clearBtn">Clear</button>
                    </div>
                    <canvas id="drawing-canvas"></canvas>
                </div>
                <div class="drawing-actions">
                    <button id="back-to-gallery-btn">Back to Gallery</button>
                    <button id="submitArtBtn" class="submit-art-btn">Lock In Your Art</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // ===== 1. KONEKSI FIREBASE (PASTIKAN KUNCI ANDA BENAR) =====
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, where } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCFKSgYfeR_Gql7qZdP5_EYVw-BO5VkNCE",
            authDomain: "succinct-comboard.firebaseapp.com",
            projectId: "succinct-comboard",
            storageBucket: "succinct-comboard.appspot.com",
            messagingSenderId: "853910523370",
            appId: "1:853910523370:web:f0b2e11ba95067bc35f693"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const artCollection = collection(db, "arts");
        let currentUser = null;

        // Coba login saat halaman pertama kali dimuat
        signInAnonymously(auth).catch((error) => console.error("Anonymous sign-in failed:", error));
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                console.log("User signed in anonymously:", user.uid);
            } else {
                currentUser = null;
            }
        });

        // ===== 2. KODE UI DASAR (TIDAK BERUBAH) =====
        // ... (Semua kode UI lama seperti tombol enter, jam, notifikasi tetap di sini)
        const enterBtn=document.getElementById("enter-btn"),welcomeScreen=document.getElementById("welcome-screen"),mainApp=document.getElementById("main-app"),music=document.getElementById("background-music");enterBtn&&enterBtn.addEventListener("click",()=>{music&&(music.volume=.3,music.play().catch(e=>console.error("Audio play failed:",e))),welcomeScreen&&(welcomeScreen.style.display="none"),mainApp&&mainApp.classList.remove("hidden")});const chatNotifications=[{name:"Yinger UwU",photo:"assets/images/yinger.png",message:"Dont forget succinct rockstars!"},{name:"Addyyeah",photo:"assets/images/addy.jpg",message:"Mainnet soon yeahh"},{name:"Zaharon bruhh",photo:"assets/images/zaharon.jpg",message:"Log in bruhh, lets play together"},{name:"Duskieee",photo:"assets/images/duskie.jpg",message:"Thanks for joining!"}];function showRandomNotifications(){const e=document.getElementById("notification-list");if(e){e.innerHTML="";const t=chatNotifications.sort(()=>.5-Math.random())[0];t&&(e.innerHTML=`<li class="notification-item"><img src="${t.photo}" alt="${t.name}"><div class="notification-content"><p>${t.name}</p><span>${t.message}</span></div></li>`)}}function updateDateTime(){const e=new Date,t=document.getElementById("clock"),o=document.getElementById("date-widget");t&&(t.textContent=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})),o&&(o.textContent=e.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}))}showRandomNotifications(),updateDateTime(),setInterval(updateDateTime,1e3);

        // ===== 3. PENGATURAN POPUP/MODAL (TIDAK BERUBAH) =====
        function setupModal(t,o,n,a){const d=document.getElementById(t),i=document.getElementById(o),c=document.getElementById(n);if(d&&i&&c){const t=()=>{i.classList.remove("hidden"),i.classList.add("visible"),a&&a()},o=()=>{i.classList.remove("visible"),setTimeout(()=>i.classList.add("hidden"),300)};d.addEventListener("click",t),c.addEventListener("click",o),i.querySelector(".modal-overlay").addEventListener("click",o)}}const consoleOutput=document.getElementById("sp1-console"),verificationSteps=["Initializing ZKVM...","Compiling program...","Generating proof...","âœ… Execution Verified."];function runConsoleAnimation(){if(consoleOutput){consoleOutput.innerHTML="";let t=0;const o=setInterval(()=>{if(t<verificationSteps.length){const n=document.createElement("span");n.className="console-line",n.textContent=`> ${verificationSteps[t]}`,consoleOutput.appendChild(n),consoleOutput.scrollTop=consoleOutput.scrollHeight,t++}else clearInterval(o)},800)}}setupModal("open-sp1-verifier","sp1-verifier-modal","close-sp1-modal",runConsoleAnimation);

        // ===== 4. PENGATURAN COMMUNITY BOARD (PERBAIKAN TOTAL) =====
        const galleryView=document.getElementById("gallery-view"),drawingView=document.getElementById("drawing-view"),goToDrawingBtn=document.getElementById("go-to-drawing-btn"),backToGalleryBtn=document.getElementById("back-to-gallery-btn"),galleryContainer=document.getElementById("art-gallery-container"),canvas=document.getElementById("drawing-canvas");if(canvas&&galleryView){goToDrawingBtn.addEventListener("click",async()=>{const t=await checkIfUserHasDrawn();t?(alert("You have already submitted your art for the memorial!"),backToGalleryBtn.click()):(galleryView.classList.add("hidden"),drawingView.classList.remove("hidden"),setupCanvas())}),backToGalleryBtn.addEventListener("click",()=>{drawingView.classList.add("hidden"),galleryView.classList.remove("hidden")});async function loadAllArt(){galleryContainer.innerHTML='<p class="loading-text">Loading memorial wall...</p>';try{const t=await getDocs(query(artCollection,orderBy("createdAt","desc")));if(galleryContainer.innerHTML="",t.empty)galleryContainer.innerHTML='<p class="loading-text">The wall is empty. Be the first to leave a mark!</p>';else{t.forEach(t=>{const o=t.data(),n=document.createElement("div");n.className="art-piece";const a=new Image;a.src=o.imageData,n.appendChild(a),galleryContainer.appendChild(n)})}}catch(t){console.error("Failed to load art:",t),galleryContainer.innerHTML='<p class="loading-text">Could not load the memorial wall. Please try again later.</p>'}}async function checkIfUserHasDrawn(){if(!currentUser)return!1;const t=query(artCollection,where("userId","==",currentUser.uid),limit(1)),o=await getDocs(t);return!o.empty}setupModal("open-community-board","community-board-modal","close-community-modal",loadAllArt);const ctx=canvas.getContext("2d"),colorPicker=document.getElementById("colorPicker"),brushSize=document.getElementById("brushSize"),eraserBtn=document.getElementById("eraserBtn"),clearBtn=document.getElementById("clearBtn"),submitArtBtn=document.getElementById("submitArtBtn");let isDrawing=!1,isEraser=!1;function setupCanvas(){const t=canvas.parentElement;canvas.width=t.clientWidth,canvas.height=400,ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.lineJoin="round",ctx.lineCap="round",submitArtBtn.disabled=!1,submitArtBtn.textContent="Lock In Your Art"}function startDrawing(t){isDrawing=!0,draw(t)}function stopDrawing(){isDrawing=!1,ctx.beginPath()}function draw(t){if(isDrawing){t.preventDefault();const o=canvas.getBoundingClientRect(),n=(t.clientX||t.touches[0].clientX)-o.left,a=(t.clientY||t.touches[0].clientY)-o.top;ctx.lineWidth=brushSize.value,ctx.strokeStyle=isEraser?"white":colorPicker.value,ctx.lineTo(n,a),ctx.stroke(),ctx.beginPath(),ctx.moveTo(n,a)}}canvas.addEventListener("pointerdown",startDrawing),canvas.addEventListener("pointerup",stopDrawing),canvas.addEventListener("pointerout",stopDrawing),canvas.addEventListener("pointermove",draw),clearBtn.addEventListener("click",()=>{ctx.fillStyle="white",ctx.fillRect(0,0,canvas.width,canvas.height)}),eraserBtn.addEventListener("click",()=>{isEraser=!isEraser,eraserBtn.classList.toggle("active",isEraser)}),submitArtBtn.addEventListener("click",async()=>{if(!currentUser)return void alert("Authentication error. Please refresh and try again.");try{const t=canvas.toDataURL("image/png");submitArtBtn.disabled=!0,submitArtBtn.textContent="Saving...",await addDoc(artCollection,{userId:currentUser.uid,imageData:t,createdAt:new Date}),alert("Your art has been saved to the memorial wall!"),submitArtBtn.textContent="Thank You!",backToGalleryBtn.click()}catch(t){console.error("Error saving art:",t),alert("Sorry, could not save your art."),submitArtBtn.disabled=!1,submitArtBtn.textContent="Lock In Your Art"}})}
    </script>
</body>
</html>
